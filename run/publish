#!/usr/bin/env bash

mkdir -p "./autogenerated"
rm -rf "./autogenerated/package.vsix"
npx vsce package --out "./autogenerated/package.vsix" && echo "packaged VSCE"
npx vsce publish --pat "$1" && echo "published on VSCE"
npx ovsx publish -p "$2" && echo "published on OVSX"

tag_name="$(jq '.version' ./package.json)"
git tag "$tag_name" && git push origin "$tag_name"

code --install-extension "./autogenerated/package.vsix" && echo "installed package"